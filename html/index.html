<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html dir="ltr">
    
<head>
<meta name="viewport"
  content="width=device-width,
  minimum-scale=1.0, maximum-scale=1.0" />
<style type="text/css">
	body, html { font-family:helvetica,arial,sans-serif; font-size:90%; }
</style>
<style type="text/css">
    html, body { width: 100%; margin: 0; }
    button.incdec { width: 100%; }
    text.spacer { width: 30%; }
    td.valuelabel { width: 15%; text-align: center}
    td.valuevalue { width: 15%; text-align: center}
    td.buttontrio { width: 10%; text-align: center}
</style>

<script src="dojo/dojo.js" djConfig="parseOnLoad: true"> </script>
<script src="viz.js" djConfig="parseOnLoad: true"> </script>
<script type="text/javascript">

function setup() {

	var title = dojo.byId("title");
	var host = document.location.host;
	var i = host.indexOf(":");
	var instancenum = 1;
	if ( i > 0 ) {
		var port = host.substr(i+1);
		instancenum = port - 4439;
	}
	title.innerHTML = "<h2>Viz Control</h2>";
	title.innerHTML += "<a href=params.html>Params Editor</a>";

	var html = "";

	// var server = dojo.byId("vizserver");
	// html += "<b>VizServer</b>";
	// server.innerHTML = html;

	html = "";

	var viztags = doapi('viztags').result;

	var plugins = dojo.byId("vizplugins");

	if ( viztags == "" ) {
		plugins.innerHTML = "No viz plugins are present.";
		return;
	}

	var tags = viztags.split(",");
	var r;
	for ( var i=0; i<tags.length; i++ ) {
		tag = tags[i];
		html += "<p><hr>"+tag+"\n";

		var desc = doapi(tag+'.description').result;
		html += "<p>Description: "+desc + "\n";

		var about = doapi(tag+'.about').result;
		html += "<p>About: "+about + "\n";

		var apis = doapi(tag+'.apis').result;
		if ( apis == "" ) {
			html += "<p>No APIs";
		} else {
			html += "<table>";
			html += "<tr><td>APIs:</td></tr>";

			var a = apis.split(";");
			for ( var n=0; n<a.length; n++ ) {
				html += "<tr><td></td>";
				var w = a[n].split(/[\(\)]/);
				// We expect the length of w to be either 1 (just an api name) or
				// 3 (api name + argument)
				var api = w[0];
				var fullapiname = tag + "." + api;
				if ( w.length <= 1 ) {
					html += "<td><input type=\"button\" style=\"width:100px\" value=\""+a[n]+"\" onClick=\"doapi('"+fullapiname+"');\"></td>";
				} else if ( w.length != 3 ) {
					alert("Hey, too many arguments on api="+w[0]+" length="+w.length+" an="+a[n]);
				} else {
					var args = w[1].split(",");

					var argname = args[0];
					var inputid = tag+"_"+api;
					var argstr = "&quot;" + argname + "&quot; : "
						+ "&quot;'+document.getElementById(&quot;" + inputid + "&quot;).value+'&quot;";

					html += "<td><input type=\"button\" style=\"width:100px\" value=\""
						+api+"\" onClick=\"doapi('"+fullapiname+"','{"+argstr+"}');\"></td>";

					html += "<td width=10></td><td align=right>"
						+argname+"&nbsp;=&nbsp;</td><td><input type=\"text\" id=\""+inputid+"\" size=8></td>";
				}
				html += "</tr>";
			}
			html += "</table>";
		}
	}
	plugins.innerHTML = html;

	// After the HTML is all done and enabled, set the values using any apis that start with "set_"
	for ( var i=0; i<tags.length; i++ ) {
		tag = tags[i];
		var apis = doapi(tag+'.apis').result;
		if ( apis != "" ) {
			var a = apis.split(";");
			for ( var n=0; n<a.length; n++ ) {
				html += "<tr><td></td>";
				var w = a[n].split(/[\(\)]/);
				if ( w.length <= 1 ) {
					continue;
				}
				var api = w[0];
				var args = w[1].split(",");
				if ( api.search("set_") != 0 ) {
					continue;
				}
				argname = api.substring(4);
				var getapi = tag + ".get_" + argname;
				var val = doapi(getapi).result;
				var inputid = tag+"_"+api;
				document.getElementById(inputid).value = val;
			}
		}
	}
}

dojo.addOnLoad(setup);
</script>
</head>
    
<body class="claro">

<center>
<div id="title">&nbsp;</div>
<br>
</center>
<p>
<div id="vizserver"></div>
<p>
<div id="vizplugins"></div>
<p>
	
</body>

</html>

